<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multiple-Strain Model of COVID and Vaccines · AlgebraicPetri.jl</title><meta name="title" content="Multiple-Strain Model of COVID and Vaccines · AlgebraicPetri.jl"/><meta property="og:title" content="Multiple-Strain Model of COVID and Vaccines · AlgebraicPetri.jl"/><meta property="twitter:title" content="Multiple-Strain Model of COVID and Vaccines · AlgebraicPetri.jl"/><meta name="description" content="Documentation for AlgebraicPetri.jl."/><meta property="og:description" content="Documentation for AlgebraicPetri.jl."/><meta property="twitter:description" content="Documentation for AlgebraicPetri.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><script src="../../../assets/analytics.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">AlgebraicPetri.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">AlgebraicPetri.jl</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../predation/lotka-volterra/">Lotka-Volterra Model</a></li><li><a class="tocitem" href="../epidemiology/">Basic Epidemiology Models</a></li><li><a class="tocitem" href="../../enzymes/enzyme_reactions/">Cathepsin Enzyme Reactions</a></li><li><a class="tocitem" href="../bilayerconversion/">Converting Models to Computation Graphs</a></li><li><a class="tocitem" href="../stratification/">Stratification of COVID Models</a></li><li class="is-active"><a class="tocitem" href>Multiple-Strain Model of COVID and Vaccines</a><ul class="internal"><li><a class="tocitem" href="#Define-basic-epidemiology-model"><span>Define basic epidemiology model</span></a></li><li><a class="tocitem" href="#Define-a-model-of-multiple-vaccine-types"><span>Define a model of multiple vaccine types</span></a></li><li><a class="tocitem" href="#Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types"><span>Stratify the SIRD model with vaccinations for two vaccine types</span></a></li><li><a class="tocitem" href="#Define-a-model-of-multiple-disease-strains"><span>Define a model of multiple disease strains</span></a></li><li><a class="tocitem" href="#Stratify-the-SIRD-model-for-two-strains"><span>Stratify the SIRD model for two strains</span></a></li><li><a class="tocitem" href="#Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models"><span>Define a new type system and corresponding disease and multi-strain models</span></a></li><li><a class="tocitem" href="#Post-composition:-Typing-the-type-system"><span>Post-composition: Typing the type system</span></a></li><li><a class="tocitem" href="#Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types"><span>Define a multi-strain SIRD model with vaccination by multiple vaccine types</span></a></li><li><a class="tocitem" href="#Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model"><span>Re-stratify the multi-strain multi-vax SIRD model with the simple trip model</span></a></li></ul></li><li><a class="tocitem" href="../max_common_subobject/">Maximum Common Sub C-Set</a></li></ul></li><li><a class="tocitem" href="../../../api/">Library Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Multiple-Strain Model of COVID and Vaccines</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multiple-Strain Model of COVID and Vaccines</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/AlgebraicPetri.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/AlgebraicPetri.jl/blob/main/docs/literate/covid/disease_strains.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="multistrain_example"><a class="docs-heading-anchor" href="#multistrain_example">Multiple-Strain Model of COVID and Vaccines</a><a id="multistrain_example-1"></a><a class="docs-heading-anchor-permalink" href="#multistrain_example" title="Permalink"></a></h1><p><a href="https://nbviewer.jupyter.org/github/AlgebraicJulia/AlgebraicPetri.jl/blob/gh-pages/dev/generated/covid/disease_strains.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><pre><code class="language-julia hljs">using AlgebraicPetri, AlgebraicPetri.TypedPetri
using Catlab.Programs, Catlab.Graphics
using Catlab.CategoricalAlgebra
using Catlab.WiringDiagrams
using DisplayAs, Markdown</code></pre><p>This example presents models incorporating multiple strains of disease and vaccine type. Importantly, it shows why stratification by disease strain is different from other stratifications, e.g. geography or age, and requires using a different type system.</p><h2 id="Define-basic-epidemiology-model"><a class="docs-heading-anchor" href="#Define-basic-epidemiology-model">Define basic epidemiology model</a><a id="Define-basic-epidemiology-model-1"></a><a class="docs-heading-anchor-permalink" href="#Define-basic-epidemiology-model" title="Permalink"></a></h2><p>We start by defining our basic type system for infectious disease models.</p><pre><code class="language-julia hljs">const infectious_ontology = LabelledPetriNet(
  [:Pop],
  :infect =&gt; ((:Pop, :Pop) =&gt; (:Pop, :Pop)),
  :disease =&gt; (:Pop =&gt; :Pop),
  :strata =&gt; (:Pop =&gt; :Pop)
)

to_graphviz(infectious_ontology)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="180pt" height="241pt"
 viewBox="0.00 0.00 179.90 240.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 236.5)">
<title>G</title>
<polygon fill="%23ffffff" stroke="transparent" points="-4,4 -4,-236.5 175.895,-236.5 175.895,4 -4,4"/>
<!-- n1 -->
<g id="node1" class="node">
<title>n1</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="27.9475" cy="-112.5" rx="27.8951" ry="27.8951"/>
<text text-anchor="middle" x="27.9475" y="-108.8" font-family="Times,serif" font-size="14.00" fill="%23000000">Pop</text>
</g>
<!-- n2 -->
<g id="node2" class="node">
<title>n2</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="165.895,-232.5 107.895,-232.5 107.895,-174.5 165.895,-174.5 165.895,-232.5"/>
<text text-anchor="middle" x="136.895" y="-199.8" font-family="Times,serif" font-size="14.00" fill="%23000000">infect</text>
</g>
<!-- n1&%2345;&gt;n2 -->
<g id="edge1" class="edge">
<title>n1&%2345;&gt;n2</title>
<path fill="none" stroke="%23000000" d="M38.5424,-138.5846C46.184,-154.3106 57.9635,-173.5473 73.895,-185.5 80.8928,-190.7501 89.3717,-194.4702 97.8105,-197.1059"/>
<polygon fill="%23000000" stroke="%23000000" points="97.0421,-200.5234 107.6071,-199.7284 98.8523,-193.7615 97.0421,-200.5234"/>
<text text-anchor="middle" x="78.895" y="-194.3" font-family="Times,serif" font-size="14.00" fill="%23000000">2</text>
</g>
<!-- n3 -->
<g id="node3" class="node">
<title>n3</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="171.895,-153.5 101.895,-153.5 101.895,-83.5 171.895,-83.5 171.895,-153.5"/>
<text text-anchor="middle" x="136.895" y="-114.8" font-family="Times,serif" font-size="14.00" fill="%23000000">disease</text>
</g>
<!-- n1&%2345;&gt;n3 -->
<g id="edge3" class="edge">
<title>n1&%2345;&gt;n3</title>
<path fill="none" stroke="%23000000" d="M56.0042,-114.0451C66.7322,-114.636 79.2637,-115.3261 91.2152,-115.9843"/>
<polygon fill="%23000000" stroke="%23000000" points="91.3314,-119.4959 101.5088,-116.5512 91.7164,-112.5065 91.3314,-119.4959"/>
<text text-anchor="middle" x="78.895" y="-119.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n4 -->
<g id="node4" class="node">
<title>n4</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="166.395,-59 107.395,-59 107.395,0 166.395,0 166.395,-59"/>
<text text-anchor="middle" x="136.895" y="-25.8" font-family="Times,serif" font-size="14.00" fill="%23000000">strata</text>
</g>
<!-- n1&%2345;&gt;n4 -->
<g id="edge6" class="edge">
<title>n1&%2345;&gt;n4</title>
<path fill="none" stroke="%23000000" d="M49.6609,-94.0103C57.2357,-87.703 65.8538,-80.6847 73.895,-74.5 81.8858,-68.3541 90.6018,-61.947 98.9322,-55.9591"/>
<polygon fill="%23000000" stroke="%23000000" points="100.9856,-58.7937 107.093,-50.1363 96.9198,-53.0954 100.9856,-58.7937"/>
<text text-anchor="middle" x="78.895" y="-78.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n2&%2345;&gt;n1 -->
<g id="edge5" class="edge">
<title>n2&%2345;&gt;n1</title>
<path fill="none" stroke="%23000000" d="M107.5782,-179.0127C91.9836,-165.987 72.8641,-150.0172 57.2688,-136.991"/>
<polygon fill="%23000000" stroke="%23000000" points="59.3907,-134.2031 49.472,-130.4787 54.9033,-139.5755 59.3907,-134.2031"/>
<text text-anchor="middle" x="78.895" y="-161.3" font-family="Times,serif" font-size="14.00" fill="%23000000">2</text>
</g>
<!-- n3&%2345;&gt;n1 -->
<g id="edge2" class="edge">
<title>n3&%2345;&gt;n1</title>
<path fill="none" stroke="%23000000" d="M101.6822,-100.0859C95.8776,-97.7765 89.8191,-95.7788 83.895,-94.5 76.8589,-92.9811 69.452,-93.6663 62.413,-95.4562"/>
<polygon fill="%23000000" stroke="%23000000" points="60.8508,-92.2858 52.4494,-98.7408 63.0425,-98.9339 60.8508,-92.2858"/>
<text text-anchor="middle" x="78.895" y="-98.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n4&%2345;&gt;n1 -->
<g id="edge4" class="edge">
<title>n4&%2345;&gt;n1</title>
<path fill="none" stroke="%23000000" d="M107.3181,-16.0899C96.1597,-13.0676 83.7844,-12.3264 73.895,-18.5 54.0322,-30.8997 42.5228,-54.6459 35.9904,-75.1677"/>
<polygon fill="%23000000" stroke="%23000000" points="32.5863,-74.3404 33.1686,-84.9192 39.3104,-76.2862 32.5863,-74.3404"/>
<text text-anchor="middle" x="78.895" y="-22.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
</g>
</svg>
'/><p>We define a simple SIRD model with reflexive transitions typed as <code>:strata</code> to indicate which states can be stratified. Here we add reflexive transitions to the susceptible, infected, and recovered populations but we leave out the dead population because they cannot do things such as get vaccinated or travel between regions.</p><pre><code class="language-julia hljs">sird_uwd = @relation (S,I,R,D) where (S::Pop, I::Pop, R::Pop, D::Pop) begin
  infect(S, I, I, I)
  disease(I, R)
  disease(I, D)
end

sird_model = oapply_typed(infectious_ontology, sird_uwd, [:infection, :recovery, :death])
sird_model = add_reflexives(sird_model, [[:strata], [:strata], [:strata], []], infectious_ontology)

to_graphviz(dom(sird_model))</code></pre><img src="2fde7eca.svg" alt="Example block output"/><h2 id="Define-a-model-of-multiple-vaccine-types"><a class="docs-heading-anchor" href="#Define-a-model-of-multiple-vaccine-types">Define a model of multiple vaccine types</a><a id="Define-a-model-of-multiple-vaccine-types-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-model-of-multiple-vaccine-types" title="Permalink"></a></h2><p>We also define a model of vaccination with multiple vaccine types. In this model, vaccination transitions are typed as <code>:strata</code>. Note that the <code>:infect</code> transitions must be included to enable cross-infection between different vax types.</p><pre><code class="language-julia hljs">function vax_model(n)
  uwd = RelationDiagram(repeat([:Pop], n+1))

  variable = :Unvaxxed
  junction = add_junction!(uwd, :Pop, variable=variable)
  port = ports(uwd, outer=true)[1]
  set_junction!(uwd, port, junction, outer=true)
  junctions = Dict(variable =&gt; junction)
  for i in 1:n
    variable = Symbol(&quot;VaxType$(i)&quot;)
    junction = add_junction!(uwd, :Pop, variable=variable)
    port = ports(uwd, outer=true)[i+1]
    set_junction!(uwd, port, junction, outer=true)
    junctions[variable] = junction
  end

  strains = filter((x) -&gt; x != Symbol(&quot;Unvaxxed&quot;), keys(junctions))
  for s in strains
    pair = (:Unvaxxed, s)
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=:strata)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end
  tnames = [Symbol(&quot;vax_$(b)&quot;) for b in strains]

  pairs = collect(Iterators.product(keys(junctions), keys(junctions)))
  for pair in pairs
    ins_outs = (pair[1], pair[2], pair[1], pair[2])
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in ins_outs], name=:infect)
    for (rgn, port) in zip(ins_outs, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
    push!(tnames,Symbol(&quot;inf_$(pair[1])_$(pair[2])&quot;))
  end
  act = oapply_typed(infectious_ontology, uwd, tnames)
  add_reflexives(act, repeat([[:disease]], n+1), infectious_ontology)
end

to_graphviz(dom(vax_model(2)))</code></pre><img src="b46434bd.svg" alt="Example block output"/><h2 id="Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types"><a class="docs-heading-anchor" href="#Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types">Stratify the SIRD model with vaccinations for two vaccine types</a><a id="Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types-1"></a><a class="docs-heading-anchor-permalink" href="#Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types" title="Permalink"></a></h2><p>We can now stratify the two typed models to get a model of SIRD with vaccination by multiple possible vaccine types.</p><pre><code class="language-julia hljs">typed_product(sird_model, vax_model(2)) |&gt; dom |&gt; to_graphviz</code></pre><img src="8aca9931.svg" alt="Example block output"/><h2 id="Define-a-model-of-multiple-disease-strains"><a class="docs-heading-anchor" href="#Define-a-model-of-multiple-disease-strains">Define a model of multiple disease strains</a><a id="Define-a-model-of-multiple-disease-strains-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-model-of-multiple-disease-strains" title="Permalink"></a></h2><p>Here we define a model of multiple strains of disease infection. In this model, uninfected individuals can become infected by indivuals carrying one of the strains. This model can be typed  the <code>infectious_ontology</code>. We add reflexives of <code>:disease</code> and <code>:strata</code> for the strain states but only <code>:strata</code> for the uninfected state.</p><pre><code class="language-julia hljs">function strain_model′(n)
  uwd = RelationDiagram(repeat([:Pop], n+1))
  variable = :Uninfected
  junction = add_junction!(uwd, :Pop, variable=variable)
  port = ports(uwd, outer=true)[1]
  set_junction!(uwd, port, junction, outer=true)
  junctions = Dict(variable =&gt; junction)
  for i in 1:n
    variable = Symbol(&quot;Strain$(i)&quot;)
    junction = add_junction!(uwd, :Pop, variable=variable)
    port = ports(uwd, outer=true)[i+1]
    set_junction!(uwd, port, junction, outer=true)
    junctions[variable] = junction
  end
  strains = filter((x) -&gt; x != Symbol(&quot;Uninfected&quot;), keys(junctions))
  for s in strains
    pair = (:Uninfected, s, s, s)
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=:infect)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end
  act = oapply_typed(infectious_ontology, uwd, [Symbol(&quot;inf_$(b)&quot;) for b in strains])
  add_reflexives(act, vcat([[:strata]],repeat([[:disease,:strata]], n)), infectious_ontology)
end

to_graphviz(dom(strain_model′(2)))</code></pre><img src="424f4926.svg" alt="Example block output"/><h2 id="Stratify-the-SIRD-model-for-two-strains"><a class="docs-heading-anchor" href="#Stratify-the-SIRD-model-for-two-strains">Stratify the SIRD model for two strains</a><a id="Stratify-the-SIRD-model-for-two-strains-1"></a><a class="docs-heading-anchor-permalink" href="#Stratify-the-SIRD-model-for-two-strains" title="Permalink"></a></h2><p>Unfortunately, stratification of these models does not produce the desired result. There are quite a few extraneous states and transitions. The primary issue is the asymmetry in the role of the uninfected population. We can address this by changing the type system.</p><pre><code class="language-julia hljs">typed_product(sird_model, strain_model′(2)) |&gt; dom |&gt; to_graphviz</code></pre><img src="217bc125.svg" alt="Example block output"/><h2 id="Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models"><a class="docs-heading-anchor" href="#Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models">Define a new type system and corresponding disease and multi-strain models</a><a id="Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models" title="Permalink"></a></h2><p>The new type system has separate states for uninfected and infected to account for the asymmetry in their role in infection and for the corresponding asymmetry in the intended stratification. Accordingly, the <code>:Inf</code> state has <code>:disease</code> and <code>:strataI</code> transitions. The <code>:Uninf</code> state only has an additional &quot;strata&quot; transition, <code>:strataU</code>, but note this transition is distinct from that for the <code>:Inf</code> state.</p><pre><code class="language-julia hljs">const strain_ontology = LabelledPetriNet(
  [:Uninf, :Inf],
  :infect =&gt; ((:Uninf, :Inf) =&gt; (:Inf, :Inf)),
  :disease =&gt; (:Inf =&gt; :Inf),
  :strataI =&gt; (:Inf =&gt; :Inf),
  :strataU =&gt; (:Uninf =&gt; :Uninf)
)

to_graphviz(strain_ontology)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="408pt" height="212pt"
 viewBox="0.00 0.00 407.89 211.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 207.5)">
<title>G</title>
<polygon fill="%23ffffff" stroke="transparent" points="-4,4 -4,-207.5 403.8893,-207.5 403.8893,4 -4,4"/>
<!-- n1 -->
<g id="node1" class="node">
<title>n1</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="36.3968" cy="-73.5" rx="36.2938" ry="36.2938"/>
<text text-anchor="middle" x="36.3968" y="-69.8" font-family="Times,serif" font-size="14.00" fill="%23000000">Uninf</text>
</g>
<!-- n3 -->
<g id="node3" class="node">
<title>n3</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="183.2935,-147.5 125.2935,-147.5 125.2935,-89.5 183.2935,-89.5 183.2935,-147.5"/>
<text text-anchor="middle" x="154.2935" y="-114.8" font-family="Times,serif" font-size="14.00" fill="%23000000">infect</text>
</g>
<!-- n1&%2345;&gt;n3 -->
<g id="edge6" class="edge">
<title>n1&%2345;&gt;n3</title>
<path fill="none" stroke="%23000000" d="M70.4974,-86.5159C84.5323,-91.8728 100.8673,-98.1077 115.3679,-103.6425"/>
<polygon fill="%23000000" stroke="%23000000" points="114.4723,-107.0469 125.063,-107.343 116.9685,-100.5071 114.4723,-107.0469"/>
<text text-anchor="middle" x="95.7935" y="-100.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n6 -->
<g id="node6" class="node">
<title>n6</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="189.7935,-71 118.7935,-71 118.7935,0 189.7935,0 189.7935,-71"/>
<text text-anchor="middle" x="154.2935" y="-31.8" font-family="Times,serif" font-size="14.00" fill="%23000000">strataU</text>
</g>
<!-- n1&%2345;&gt;n6 -->
<g id="edge7" class="edge">
<title>n1&%2345;&gt;n6</title>
<path fill="none" stroke="%23000000" d="M71.132,-62.3043C82.9231,-58.5038 96.2784,-54.1992 108.7819,-50.1691"/>
<polygon fill="%23000000" stroke="%23000000" points="110.1366,-53.4099 118.5807,-47.0108 107.9891,-46.7474 110.1366,-53.4099"/>
<text text-anchor="middle" x="95.7935" y="-60.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n2 -->
<g id="node2" class="node">
<title>n2</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="259.8414" cy="-118.5" rx="24.0958" ry="24.0958"/>
<text text-anchor="middle" x="259.8414" y="-114.8" font-family="Times,serif" font-size="14.00" fill="%23000000">Inf</text>
</g>
<!-- n2&%2345;&gt;n3 -->
<g id="edge9" class="edge">
<title>n2&%2345;&gt;n3</title>
<path fill="none" stroke="%23000000" d="M238.6206,-106.8092C232.1307,-103.8175 224.8414,-101.0184 217.7935,-99.5 209.7162,-97.7598 201.1742,-98.4905 193.0639,-100.4431"/>
<polygon fill="%23000000" stroke="%23000000" points="192.007,-97.106 183.4452,-103.3467 194.03,-103.8073 192.007,-97.106"/>
<text text-anchor="middle" x="212.7935" y="-103.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n4 -->
<g id="node4" class="node">
<title>n4</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="399.8893,-203.5 329.8893,-203.5 329.8893,-133.5 399.8893,-133.5 399.8893,-203.5"/>
<text text-anchor="middle" x="364.8893" y="-164.8" font-family="Times,serif" font-size="14.00" fill="%23000000">disease</text>
</g>
<!-- n2&%2345;&gt;n4 -->
<g id="edge1" class="edge">
<title>n2&%2345;&gt;n4</title>
<path fill="none" stroke="%23000000" d="M276.9588,-135.827C284.1292,-142.2197 292.8857,-148.9947 301.8893,-153.5 307.5639,-156.3395 313.7984,-158.6561 320.0701,-160.5423"/>
<polygon fill="%23000000" stroke="%23000000" points="319.3166,-163.9637 329.8813,-163.1653 321.1246,-157.2012 319.3166,-163.9637"/>
<text text-anchor="middle" x="306.8893" y="-161.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n5 -->
<g id="node5" class="node">
<title>n5</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="397.3893,-108 332.3893,-108 332.3893,-43 397.3893,-43 397.3893,-108"/>
<text text-anchor="middle" x="364.8893" y="-71.8" font-family="Times,serif" font-size="14.00" fill="%23000000">strataI</text>
</g>
<!-- n2&%2345;&gt;n5 -->
<g id="edge3" class="edge">
<title>n2&%2345;&gt;n5</title>
<path fill="none" stroke="%23000000" d="M282.0531,-108.8604C288.4418,-106.1234 295.4291,-103.164 301.8893,-100.5 308.6204,-97.7243 315.778,-94.8299 322.7629,-92.0364"/>
<polygon fill="%23000000" stroke="%23000000" points="324.1276,-95.2603 332.1242,-88.3101 321.5387,-88.7566 324.1276,-95.2603"/>
<text text-anchor="middle" x="306.8893" y="-104.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n3&%2345;&gt;n2 -->
<g id="edge2" class="edge">
<title>n3&%2345;&gt;n2</title>
<path fill="none" stroke="%23000000" d="M183.4144,-118.5C196.3179,-118.5 211.6001,-118.5 225.0949,-118.5"/>
<polygon fill="%23000000" stroke="%23000000" points="225.4547,-122.0001 235.4547,-118.5 225.4546,-115.0001 225.4547,-122.0001"/>
<text text-anchor="middle" x="212.7935" y="-122.3" font-family="Times,serif" font-size="14.00" fill="%23000000">2</text>
</g>
<!-- n4&%2345;&gt;n2 -->
<g id="edge4" class="edge">
<title>n4&%2345;&gt;n2</title>
<path fill="none" stroke="%23000000" d="M329.7225,-144.0812C323.9119,-140.594 317.8395,-137.26 311.8893,-134.5 305.98,-131.759 299.4811,-129.3344 293.138,-127.2544"/>
<polygon fill="%23000000" stroke="%23000000" points="293.9922,-123.8556 283.4057,-124.2736 291.9422,-130.5487 293.9922,-123.8556"/>
<text text-anchor="middle" x="306.8893" y="-138.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n5&%2345;&gt;n2 -->
<g id="edge5" class="edge">
<title>n5&%2345;&gt;n2</title>
<path fill="none" stroke="%23000000" d="M332.181,-72.0541C322.1289,-72.1623 311.2539,-73.5157 301.8893,-77.5 294.369,-80.6996 287.4357,-85.9151 281.4592,-91.5704"/>
<polygon fill="%23000000" stroke="%23000000" points="278.8578,-89.2258 274.4285,-98.8504 283.893,-94.0887 278.8578,-89.2258"/>
<text text-anchor="middle" x="306.8893" y="-81.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n6&%2345;&gt;n1 -->
<g id="edge8" class="edge">
<title>n6&%2345;&gt;n1</title>
<path fill="none" stroke="%23000000" d="M118.758,-30.9141C109.4785,-30.7992 99.6108,-31.6658 90.7935,-34.5 84.327,-36.5786 77.9775,-39.7413 72.0287,-43.3846"/>
<polygon fill="%23000000" stroke="%23000000" points="70.0019,-40.5294 63.6328,-48.9961 73.8916,-46.3492 70.0019,-40.5294"/>
<text text-anchor="middle" x="95.7935" y="-38.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
</g>
</svg>
'/><p>We now reform the SIRD model using the new type system.</p><pre><code class="language-julia hljs">sird_for_strains_uwd = @relation (S,I,R,D) where (S::Uninf, I::Inf, R::Inf, D::Inf) begin
  infect(S, I, I, I)
  disease(I, R)
  disease(I, D)
end
sird_for_strains_model = oapply_typed(strain_ontology, sird_for_strains_uwd, [:infection, :recovery, :death])
sird_for_strains_model = add_reflexives(sird_for_strains_model, [[:strataU], [:strataI], [:strataI], []], strain_ontology)

to_graphviz(dom(sird_for_strains_model))</code></pre><img src="64e3acf3.svg" alt="Example block output"/><p>And similarly reform the multi-strain model.</p><pre><code class="language-julia hljs">function strain_model(n)
  uwd = RelationDiagram(vcat([:Uninf],repeat([:Inf], n)))
  variable = :Uninfected
  junction = add_junction!(uwd, :Uninf, variable=variable)
  port = ports(uwd, outer=true)[1]
  set_junction!(uwd, port, junction, outer=true)
  junctions = Dict(variable =&gt; junction)
  for i in 1:n
    variable = Symbol(&quot;Strain$(i)&quot;)
    junction = add_junction!(uwd, :Inf, variable=variable)
    port = ports(uwd, outer=true)[i+1]
    set_junction!(uwd, port, junction, outer=true)
    junctions[variable] = junction
  end
  strains = filter((x) -&gt; x != Symbol(&quot;Uninfected&quot;), keys(junctions))
  for s in strains
    pair = (:Uninfected, s, s, s)
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=:infect)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end
  act = oapply_typed(strain_ontology, uwd, [Symbol(&quot;inf_$(b)&quot;) for b in strains])
  add_reflexives(act, vcat([[:strataU]],repeat([[:disease,:strataI]], n)), strain_ontology)
end

to_graphviz(dom(strain_model(2)))</code></pre><img src="6eff6f80.svg" alt="Example block output"/><p>When we now stratify we get the desired model.</p><pre><code class="language-julia hljs">sird_strain = typed_product(sird_for_strains_model, strain_model(2))

to_graphviz(dom(sird_strain))</code></pre><img src="00b4dbe3.svg" alt="Example block output"/><h2 id="Post-composition:-Typing-the-type-system"><a class="docs-heading-anchor" href="#Post-composition:-Typing-the-type-system">Post-composition: Typing the type system</a><a id="Post-composition:-Typing-the-type-system-1"></a><a class="docs-heading-anchor-permalink" href="#Post-composition:-Typing-the-type-system" title="Permalink"></a></h2><p>In some instances, we may want to relate models typed to different type systems. For example, we usually type our <code>simple_trip</code> model of geographic regions to the <code>infectious_ontology</code> such that we can stratify a disease model by geographic regions, but the multi-strain disease model above is typed by the new <code>strain_ontology</code>.</p><p>Crucially, we can accomplish this IF there is an appropriate morphism (map) between the type systems because post-composition by a morphism of type systems is functorial. In this case, there is a morphism from <code>strain_ontology</code> to <code>infectious_ontology</code>, so we can form the morphism</p><h3 id="Morphism-from-strain_ontology-to-infectious_ontology"><a class="docs-heading-anchor" href="#Morphism-from-strain_ontology-to-infectious_ontology">Morphism from <code>strain_ontology</code> to <code>infectious_ontology</code></a><a id="Morphism-from-strain_ontology-to-infectious_ontology-1"></a><a class="docs-heading-anchor-permalink" href="#Morphism-from-strain_ontology-to-infectious_ontology" title="Permalink"></a></h3><pre><code class="language-julia hljs">strain_ont_uwd = @relation (Uninf,Inf) where (Uninf::Pop, Inf::Pop) begin
  infect(Uninf, Inf, Inf, Inf)
  disease(Inf, Inf)
  strata(Inf, Inf)
  strata(Uninf, Uninf)
end
strain_ont_act = oapply_typed(infectious_ontology,strain_ont_uwd,[:infect,:disease,:strataI,:strataU])

to_graphviz(strain_ont_act)</code></pre><img src="8d7f78c2.svg" alt="Example block output"/><h3 id="Define-simple-trip-geographic-model-of-N-regions"><a class="docs-heading-anchor" href="#Define-simple-trip-geographic-model-of-N-regions">Define simple-trip geographic model of <span>$N$</span> regions</a><a id="Define-simple-trip-geographic-model-of-N-regions-1"></a><a class="docs-heading-anchor-permalink" href="#Define-simple-trip-geographic-model-of-N-regions" title="Permalink"></a></h3><p>To demonstrate stratification utilizing post-composition to re-type the models, we use the simple-trip geographic model. This model is comprises a travel model and a living model.</p><p><strong>Travel model between <span>$N$</span> regions</strong>\n In this model, there are <span>$N$</span> regions which people can travel between. People within the same region are able to infect other people in the same region.</p><pre><code class="language-julia hljs">function travel_model(n)
  uwd = RelationDiagram(repeat([:Pop], n))
  junctions = Dict(begin
    variable = Symbol(&quot;Region$(i)&quot;)
    junction = add_junction!(uwd, :Pop, variable=variable)
    set_junction!(uwd, port, junction, outer=true)
    variable =&gt; junction
  end for (i, port) in enumerate(ports(uwd, outer=true)))

  pairs = filter(x -&gt; first(x) != last(x), collect(Iterators.product(keys(junctions), keys(junctions))))
  for pair in pairs
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=:strata)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end

  act = oapply_typed(infectious_ontology, uwd, [Symbol(&quot;$(a)_$(b)&quot;) for (a, b) in pairs])
  add_reflexives(act, repeat([[:infect, :disease]], n), infectious_ontology)
end

to_graphviz(dom(travel_model(2)))</code></pre><img src="52cf227c.svg" alt="Example block output"/><p>This model could itself be stratified with the SIRD model, but we want to model persons travelling between locations while maintaining the status of where they live.</p><p><strong>Living model of <span>$N$</span> regions</strong>\n In this model, people have the property of &quot;Living&quot; somewhere.</p><pre><code class="language-julia hljs">function living_model(n)
  typed_living = pairwise_id_typed_petri(infectious_ontology, :Pop, :infect, [Symbol(&quot;Living$(i)&quot;) for i in 1:n])
  add_reflexives(typed_living, repeat([[:disease, :strata]], n), infectious_ontology)
end

to_graphviz(dom(living_model(2)))</code></pre><img src="5ae5b945.svg" alt="Example block output"/><p><strong>Simple trip model of <span>$N$</span> regions</strong>\n We can stratify the living model with the travel model to get a model of someone taking a simple trip.</p><pre><code class="language-julia hljs">simple_trip_model = typed_product(travel_model(2), living_model(2))

to_graphviz(dom(simple_trip_model))</code></pre><img src="ac13ceb5.svg" alt="Example block output"/><h3 id="Stratify-SIRD-multi-strain-and-simple-trip-models"><a class="docs-heading-anchor" href="#Stratify-SIRD-multi-strain-and-simple-trip-models">Stratify SIRD-multi-strain and simple-trip models</a><a id="Stratify-SIRD-multi-strain-and-simple-trip-models-1"></a><a class="docs-heading-anchor-permalink" href="#Stratify-SIRD-multi-strain-and-simple-trip-models" title="Permalink"></a></h3><p>Now, to stratify our multi-strain SIRD model with the simple-trip, we first retype the multi-strain model to the <code>infectious_ontology</code> by composing with the morphism we defined.</p><pre><code class="language-julia hljs">sird_strain_retyped = compose(sird_strain,strain_ont_act)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ACSetTransformation((T = compose(compose(compose(FinFunction([1, 7, 16, 20, 21, 29, 30, 32, 33, 41, 42], 11, 42), FinFunction(#57, FinSet(42), FinSet(6))), FinFunction([1, 2, 2, 4, 3, 3], 6, 4)), FinFunction([1, 2, 3, 3], 4, 3)), S = compose(compose(compose(FinFunction([1, 6, 7, 8, 10, 11, 12], 7, 12), FinFunction(#57, FinSet(12), FinSet(4))), FinFunction([1, 2, 2, 2], 4, 2)), FinFunction([1, 1], 2, 1)), I = compose(compose(compose(FinFunction([1, 9, 15, 23, 33, 38, 39, 48, 49, 52, 53, 62, 63], 13, 63), FinFunction(#57, FinSet(63), FinSet(7))), FinFunction([1, 2, 3, 3, 5, 4, 4], 7, 5)), FinFunction([1, 2, 3, 4, 4], 5, 4)), O = compose(compose(compose(FinFunction([1, 9, 15, 23, 33, 38, 39, 48, 49, 52, 53, 62, 63], 13, 63), FinFunction(#57, FinSet(63), FinSet(7))), FinFunction([1, 2, 3, 3, 5, 4, 4], 7, 5)), FinFunction([1, 2, 3, 4, 4], 5, 4)), Name = Catlab.CategoricalAlgebra.FinSets.LooseVarFunction{Tuple{Symbol, Symbol}, Symbol}(FinDomFunction(Union{ACSets.ColumnImplementations.AttrVar, Symbol}[], FinSet(0), TypeSet(Union{ACSets.ColumnImplementations.AttrVar, Symbol})), compose(compose(SetFunction(#23, TypeSet(Tuple{Symbol, Symbol}), TypeSet(Symbol)), SetFunction(#17, TypeSet(Symbol), TypeSet(Symbol))), SetFunction(#10, TypeSet(Symbol), TypeSet(Symbol))), FinSet(0))), AlgebraicPetri.LabelledPetriNetUntyped{Tuple{Symbol, Symbol}} {T:11, S:7, I:13, O:13, Name:0}, LabelledPetriNet {T:3, S:1, I:4, O:4, Name:0})</code></pre><p>We can now stratify.</p><pre><code class="language-julia hljs">sird_strain_trip = typed_product(sird_strain_retyped,simple_trip_model)

to_graphviz(dom(sird_strain_trip))</code></pre><img src="ec84bc6c.svg" alt="Example block output"/><h2 id="Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types"><a class="docs-heading-anchor" href="#Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types">Define a multi-strain SIRD model with vaccination by multiple vaccine types</a><a id="Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types" title="Permalink"></a></h2><p>We can similarly stratify the multi-strain SIRD model with the multi-vax model.</p><pre><code class="language-julia hljs">sird_strain_vax = typed_product(sird_strain_retyped,vax_model(2))

to_graphviz(dom(sird_strain_vax))</code></pre><img src="998c4f3d.svg" alt="Example block output"/><h2 id="Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model"><a class="docs-heading-anchor" href="#Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model">Re-stratify the multi-strain multi-vax SIRD model with the simple trip model</a><a id="Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model-1"></a><a class="docs-heading-anchor-permalink" href="#Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model" title="Permalink"></a></h2><p>If we would like to re-stratify our SIRD-strain-vax model with the simple trip model, we again face a difficulty. Both the &quot;vaccination&quot; transitions of the first model and the &quot;travel&quot; transitions of the second are currently typed to the <code>:strata</code> transition of the <code>infectious_ontology</code> type system. To appropriately stratify, we need an additional &quot;strata&quot; transition to distinguish between the two types of transitions. We can again use post-compostion to overcome the difficulty.</p><h3 id="Define-an-augmented-version-of-the-infectious_ontology-type-system-with-an-additional-&quot;strata&quot;-transition"><a class="docs-heading-anchor" href="#Define-an-augmented-version-of-the-infectious_ontology-type-system-with-an-additional-&quot;strata&quot;-transition">Define an augmented version of the <code>infectious_ontology</code> type system with an additional &quot;strata&quot; transition</a><a id="Define-an-augmented-version-of-the-infectious_ontology-type-system-with-an-additional-&quot;strata&quot;-transition-1"></a><a class="docs-heading-anchor-permalink" href="#Define-an-augmented-version-of-the-infectious_ontology-type-system-with-an-additional-&quot;strata&quot;-transition" title="Permalink"></a></h3><pre><code class="language-julia hljs">const aug_inf_ontology = LabelledPetriNet(
  [:nPop],
  :ninfect =&gt; ((:nPop, :nPop) =&gt; (:nPop, :nPop)),
  :ndisease =&gt; (:nPop =&gt; :nPop),
  :nstrata =&gt; (:nPop =&gt; :nPop),
  :nstrata2 =&gt; (:nPop =&gt; :nPop)
)

to_graphviz(aug_inf_ontology)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="201pt" height="354pt"
 viewBox="0.00 0.00 200.59 354.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 350)">
<title>G</title>
<polygon fill="%23ffffff" stroke="transparent" points="-4,4 -4,-350 196.594,-350 196.594,4 -4,4"/>
<!-- n1 -->
<g id="node1" class="node">
<title>n1</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="33.797" cy="-178.5" rx="33.5952" ry="33.5952"/>
<text text-anchor="middle" x="33.797" y="-174.8" font-family="Times,serif" font-size="14.00" fill="%23000000">nPop</text>
</g>
<!-- n2 -->
<g id="node2" class="node">
<title>n2</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="186.594,-346 119.594,-346 119.594,-279 186.594,-279 186.594,-346"/>
<text text-anchor="middle" x="153.094" y="-308.8" font-family="Times,serif" font-size="14.00" fill="%23000000">ninfect</text>
</g>
<!-- n1&%2345;&gt;n2 -->
<g id="edge1" class="edge">
<title>n1&%2345;&gt;n2</title>
<path fill="none" stroke="%23000000" d="M41.6218,-211.3938C49.0739,-236.0315 62.643,-268.9071 85.594,-289.5 92.4965,-295.6933 101.1387,-300.2314 109.9116,-303.5527"/>
<polygon fill="%23000000" stroke="%23000000" points="108.8128,-306.8757 119.4062,-306.6999 111.0153,-300.2312 108.8128,-306.8757"/>
<text text-anchor="middle" x="90.594" y="-299.3" font-family="Times,serif" font-size="14.00" fill="%23000000">2</text>
</g>
<!-- n3 -->
<g id="node3" class="node">
<title>n3</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="192.594,-261 113.594,-261 113.594,-182 192.594,-182 192.594,-261"/>
<text text-anchor="middle" x="153.094" y="-217.8" font-family="Times,serif" font-size="14.00" fill="%23000000">ndisease</text>
</g>
<!-- n1&%2345;&gt;n3 -->
<g id="edge4" class="edge">
<title>n1&%2345;&gt;n3</title>
<path fill="none" stroke="%23000000" d="M60.143,-199.8169C67.9273,-205.1116 76.7442,-210.2082 85.594,-213.5 91.1916,-215.5821 97.2141,-217.1536 103.2746,-218.3351"/>
<polygon fill="%23000000" stroke="%23000000" points="103.0118,-221.8379 113.4418,-219.9764 104.1274,-214.9273 103.0118,-221.8379"/>
<text text-anchor="middle" x="90.594" y="-219.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n4 -->
<g id="node4" class="node">
<title>n4</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="187.094,-163.5 119.094,-163.5 119.094,-95.5 187.094,-95.5 187.094,-163.5"/>
<text text-anchor="middle" x="153.094" y="-125.8" font-family="Times,serif" font-size="14.00" fill="%23000000">nstrata</text>
</g>
<!-- n1&%2345;&gt;n4 -->
<g id="edge7" class="edge">
<title>n1&%2345;&gt;n4</title>
<path fill="none" stroke="%23000000" d="M65.1409,-165.6258C78.732,-160.0434 94.8755,-153.4127 109.5988,-147.3652"/>
<polygon fill="%23000000" stroke="%23000000" points="111.1077,-150.5292 119.028,-143.4922 108.4481,-144.0542 111.1077,-150.5292"/>
<text text-anchor="middle" x="90.594" y="-160.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n5 -->
<g id="node5" class="node">
<title>n5</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="191.594,-77 114.594,-77 114.594,0 191.594,0 191.594,-77"/>
<text text-anchor="middle" x="153.094" y="-34.8" font-family="Times,serif" font-size="14.00" fill="%23000000">nstrata2</text>
</g>
<!-- n1&%2345;&gt;n5 -->
<g id="edge8" class="edge">
<title>n1&%2345;&gt;n5</title>
<path fill="none" stroke="%23000000" d="M50.9265,-149.1534C60.3443,-133.9996 72.7119,-115.5781 85.594,-100.5 92.1057,-92.8783 99.5003,-85.2531 106.949,-78.0877"/>
<polygon fill="%23000000" stroke="%23000000" points="109.4994,-80.4938 114.385,-71.0926 104.7031,-75.3952 109.4994,-80.4938"/>
<text text-anchor="middle" x="90.594" y="-104.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n2&%2345;&gt;n1 -->
<g id="edge6" class="edge">
<title>n2&%2345;&gt;n1</title>
<path fill="none" stroke="%23000000" d="M121.0693,-278.6829C118.5266,-275.9268 116.0094,-273.1741 113.594,-270.5 96.388,-251.4511 77.5548,-229.7784 62.5075,-212.2548"/>
<polygon fill="%23000000" stroke="%23000000" points="65.0442,-209.8361 55.8797,-204.5197 59.7286,-214.3907 65.0442,-209.8361"/>
<text text-anchor="middle" x="90.594" y="-251.3" font-family="Times,serif" font-size="14.00" fill="%23000000">2</text>
</g>
<!-- n3&%2345;&gt;n1 -->
<g id="edge2" class="edge">
<title>n3&%2345;&gt;n1</title>
<path fill="none" stroke="%23000000" d="M113.3247,-205.1885C107.4053,-202.8782 101.3577,-200.5827 95.594,-198.5 89.2523,-196.2084 82.5016,-193.8962 75.8789,-191.6979"/>
<polygon fill="%23000000" stroke="%23000000" points="76.9226,-188.3569 66.33,-188.5745 74.7464,-195.01 76.9226,-188.3569"/>
<text text-anchor="middle" x="90.594" y="-202.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n4&%2345;&gt;n1 -->
<g id="edge5" class="edge">
<title>n4&%2345;&gt;n1</title>
<path fill="none" stroke="%23000000" d="M118.7498,-119.3561C107.7885,-117.8241 95.8491,-118.0161 85.594,-122.5 75.6743,-126.8372 66.808,-134.115 59.3339,-142.013"/>
<polygon fill="%23000000" stroke="%23000000" points="56.2743,-140.1959 52.3364,-150.0318 61.5485,-144.7984 56.2743,-140.1959"/>
<text text-anchor="middle" x="90.594" y="-126.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
<!-- n5&%2345;&gt;n1 -->
<g id="edge3" class="edge">
<title>n5&%2345;&gt;n1</title>
<path fill="none" stroke="%23000000" d="M114.3399,-35.4993C104.1521,-36.4866 93.7453,-39.2856 85.594,-45.5 57.9187,-66.599 45.0198,-104.5761 39.0139,-134.5626"/>
<polygon fill="%23000000" stroke="%23000000" points="35.4989,-134.332 37.164,-144.7952 42.3872,-135.5774 35.4989,-134.332"/>
<text text-anchor="middle" x="90.594" y="-49.3" font-family="Times,serif" font-size="14.00" fill="%23000000">1</text>
</g>
</g>
</svg>
'/><h3 id="Define-morphisms-from-the-original-type-system-to-the-new-augmented-type-system"><a class="docs-heading-anchor" href="#Define-morphisms-from-the-original-type-system-to-the-new-augmented-type-system">Define morphisms from the original type system to the new augmented type system</a><a id="Define-morphisms-from-the-original-type-system-to-the-new-augmented-type-system-1"></a><a class="docs-heading-anchor-permalink" href="#Define-morphisms-from-the-original-type-system-to-the-new-augmented-type-system" title="Permalink"></a></h3><p>We form one morphism that maps the <code>:strata</code> transition to <code>:nstrata</code>. This morphism will serve to re-type the SIRD-strain-vax model.</p><pre><code class="language-julia hljs">function retype_inf_ont(strata_map)
  uwd = RelationDiagram([:nPop])
  variable = :Pop
  junction = add_junction!(uwd, :nPop, variable=variable)
  port = ports(uwd, outer=true)[1]
  set_junction!(uwd, port, junction, outer=true)
  junctions = Dict(variable =&gt; junction)

  boxes = [:ninfect, :ndisease, strata_map]
  for bname in boxes
    if bname == :ninfect
      pair = (:Pop, :Pop, :Pop, :Pop)
    else
      pair = (:Pop, :Pop)
    end
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=bname)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end

  act = oapply_typed(aug_inf_ontology, uwd, [:infect, :disease, :strata])
end

inf_ont_act = retype_inf_ont(:nstrata)

to_graphviz(inf_ont_act)</code></pre><img src="60767218.svg" alt="Example block output"/><p>We form another morphism that maps the <code>:strata</code> transition to <code>:nstrata2</code>. This morphism will serve to re-type the simple trip model.</p><pre><code class="language-julia hljs">rgn_ont_act = retype_inf_ont(:nstrata2)

to_graphviz(rgn_ont_act)</code></pre><img src="691a2d60.svg" alt="Example block output"/><h3 id="Add-reflexive-transitions"><a class="docs-heading-anchor" href="#Add-reflexive-transitions">Add reflexive transitions</a><a id="Add-reflexive-transitions-1"></a><a class="docs-heading-anchor-permalink" href="#Add-reflexive-transitions" title="Permalink"></a></h3><p>To finish preparing for stratification, we need to add the new reflexive transitions to the component models. To the SIRD-strain-vax model, we add an <code>:nstrata2</code> tranisiton to each state that does not represent a portion of the population that is deceased (because deceased individuals cannot travel).</p><pre><code class="language-julia hljs">sird_strain_vax_retyped = flatten_labels(compose(sird_strain_vax,inf_ont_act))
reflx = [[:nstrata2]]
for ii in 2:ns(dom(sird_strain_vax_retyped))
  if split(String(dom(sird_strain_vax_retyped)[ii,:sname]),&quot;_&quot;)[1] == &quot;D&quot;
    push!(reflx,[])
  else
    push!(reflx,[:nstrata2])
  end
end
aug_sird_strain_vax = add_reflexives(sird_strain_vax_retyped, reflx, aug_inf_ontology);</code></pre><p>To the simple trip model, we add an <code>:nstrata</code> tranisiton for each state.</p><pre><code class="language-julia hljs">simple_trip_retyped = flatten_labels(compose(simple_trip_model,rgn_ont_act))
aug_trip = add_reflexives(simple_trip_retyped, repeat([[:nstrata]],ns(dom(simple_trip_retyped))), aug_inf_ontology);</code></pre><h3 id="Stratify-the-SIRD-strain-vax-and-simple-trip-models"><a class="docs-heading-anchor" href="#Stratify-the-SIRD-strain-vax-and-simple-trip-models">Stratify the SIRD-strain-vax and simple trip models</a><a id="Stratify-the-SIRD-strain-vax-and-simple-trip-models-1"></a><a class="docs-heading-anchor-permalink" href="#Stratify-the-SIRD-strain-vax-and-simple-trip-models" title="Permalink"></a></h3><pre><code class="language-julia hljs">sird_strain_vax_trip = typed_product([aug_sird_strain_vax,aug_trip])

to_graphviz(dom(sird_strain_vax_trip))</code></pre><img src="50348082.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../stratification/">« Stratification of COVID Models</a><a class="docs-footer-nextpage" href="../max_common_subobject/">Maximum Common Sub C-Set »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 20 December 2023 10:55">Wednesday 20 December 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
