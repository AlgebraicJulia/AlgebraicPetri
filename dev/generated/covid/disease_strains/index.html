<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multiple-Strain Model of COVID and Vaccines · AlgebraicPetri.jl</title><meta name="title" content="Multiple-Strain Model of COVID and Vaccines · AlgebraicPetri.jl"/><meta property="og:title" content="Multiple-Strain Model of COVID and Vaccines · AlgebraicPetri.jl"/><meta property="twitter:title" content="Multiple-Strain Model of COVID and Vaccines · AlgebraicPetri.jl"/><meta name="description" content="Documentation for AlgebraicPetri.jl."/><meta property="og:description" content="Documentation for AlgebraicPetri.jl."/><meta property="twitter:description" content="Documentation for AlgebraicPetri.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><script src="../../../assets/analytics.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">AlgebraicPetri.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">AlgebraicPetri.jl</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../predation/lotka-volterra/">Lotka-Volterra Model</a></li><li><a class="tocitem" href="../epidemiology/">Basic Epidemiology Models</a></li><li><a class="tocitem" href="../../enzymes/enzyme_reactions/">Cathepsin Enzyme Reactions</a></li><li><a class="tocitem" href="../bilayerconversion/">Converting Models to Computation Graphs</a></li><li><a class="tocitem" href="../stratification/">Stratification of COVID Models</a></li><li class="is-active"><a class="tocitem" href>Multiple-Strain Model of COVID and Vaccines</a><ul class="internal"><li><a class="tocitem" href="#Define-basic-epidemiology-model"><span>Define basic epidemiology model</span></a></li><li><a class="tocitem" href="#Define-a-model-of-multiple-vaccine-types"><span>Define a model of multiple vaccine types</span></a></li><li><a class="tocitem" href="#Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types"><span>Stratify the SIRD model with vaccinations for two vaccine types</span></a></li><li><a class="tocitem" href="#Define-a-model-of-multiple-disease-strains"><span>Define a model of multiple disease strains</span></a></li><li><a class="tocitem" href="#Stratify-the-SIRD-model-for-two-strains"><span>Stratify the SIRD model for two strains</span></a></li><li><a class="tocitem" href="#Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models"><span>Define a new type system and corresponding disease and multi-strain models</span></a></li><li><a class="tocitem" href="#Post-composition:-Typing-the-type-system"><span>Post-composition: Typing the type system</span></a></li><li><a class="tocitem" href="#Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types"><span>Define a multi-strain SIRD model with vaccination by multiple vaccine types</span></a></li><li><a class="tocitem" href="#Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model"><span>Re-stratify the multi-strain multi-vax SIRD model with the simple trip model</span></a></li></ul></li><li><a class="tocitem" href="../max_common_subobject/">Maximum Common Sub C-Set</a></li></ul></li><li><a class="tocitem" href="../../../api/">Library Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Multiple-Strain Model of COVID and Vaccines</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multiple-Strain Model of COVID and Vaccines</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/AlgebraicPetri.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/AlgebraicPetri.jl/blob/main/docs/literate/covid/disease_strains.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="multistrain_example"><a class="docs-heading-anchor" href="#multistrain_example">Multiple-Strain Model of COVID and Vaccines</a><a id="multistrain_example-1"></a><a class="docs-heading-anchor-permalink" href="#multistrain_example" title="Permalink"></a></h1><p><a href="https://nbviewer.jupyter.org/github/AlgebraicJulia/AlgebraicPetri.jl/blob/gh-pages/dev/generated/covid/disease_strains.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><pre><code class="language-julia hljs">using AlgebraicPetri, AlgebraicPetri.TypedPetri
using Catlab.Programs, Catlab.Graphics
using Catlab.CategoricalAlgebra
using Catlab.WiringDiagrams
using DisplayAs, Markdown</code></pre><p>This example presents models incorporating multiple strains of disease and vaccine type. Importantly, it shows why stratification by disease strain is different from other stratifications, e.g. geography or age, and requires using a different type system.</p><h2 id="Define-basic-epidemiology-model"><a class="docs-heading-anchor" href="#Define-basic-epidemiology-model">Define basic epidemiology model</a><a id="Define-basic-epidemiology-model-1"></a><a class="docs-heading-anchor-permalink" href="#Define-basic-epidemiology-model" title="Permalink"></a></h2><p>We start by defining our basic type system for infectious disease models.</p><pre><code class="language-julia hljs">const infectious_ontology = LabelledPetriNet(
  [:Pop],
  :infect =&gt; ((:Pop, :Pop) =&gt; (:Pop, :Pop)),
  :disease =&gt; (:Pop =&gt; :Pop),
  :strata =&gt; (:Pop =&gt; :Pop)
)

to_graphviz(infectious_ontology)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="180pt" height="240pt"
 viewBox="0.00 0.00 179.90 240.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 236)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-236 175.9,-236 175.9,4 -4,4"/>
<!-- n1 -->
<g id="node1" class="node">
<title>n1</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="27.95" cy="-112.5" rx="27.9" ry="27.9"/>
<text text-anchor="middle" x="27.95" y="-108.8" font-family="Times,serif" font-size="14.00">Pop</text>
</g>
<!-- n2 -->
<g id="node2" class="node">
<title>n2</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="165.4,-232 108.4,-232 108.4,-175 165.4,-175 165.4,-232"/>
<text text-anchor="middle" x="136.9" y="-199.8" font-family="Times,serif" font-size="14.00">infect</text>
</g>
<!-- n1&%2345;&gt;n2 -->
<g id="edge1" class="edge">
<title>n1&%2345;&gt;n2</title>
<path fill="none" stroke="black" d="M39.03,-138.2C46.46,-153.98 58.03,-173.42 73.9,-185.5 81.09,-190.98 89.9,-194.79 98.6,-197.44"/>
<polygon fill="black" stroke="black" points="97.72,-200.83 108.28,-199.97 99.49,-194.06 97.72,-200.83"/>
<text text-anchor="middle" x="78.9" y="-194.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n3 -->
<g id="node3" class="node">
<title>n3</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="171.9,-153.5 101.9,-153.5 101.9,-83.5 171.9,-83.5 171.9,-153.5"/>
<text text-anchor="middle" x="136.9" y="-114.8" font-family="Times,serif" font-size="14.00">disease</text>
</g>
<!-- n1&%2345;&gt;n3 -->
<g id="edge3" class="edge">
<title>n1&%2345;&gt;n3</title>
<path fill="none" stroke="black" d="M55.93,-114.01C66.66,-114.62 79.28,-115.32 91.28,-116"/>
<polygon fill="black" stroke="black" points="91.43,-119.51 101.61,-116.58 91.83,-112.52 91.43,-119.51"/>
<text text-anchor="middle" x="78.9" y="-119.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n4 -->
<g id="node4" class="node">
<title>n4</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="166.4,-59 107.4,-59 107.4,0 166.4,0 166.4,-59"/>
<text text-anchor="middle" x="136.9" y="-25.8" font-family="Times,serif" font-size="14.00">strata</text>
</g>
<!-- n1&%2345;&gt;n4 -->
<g id="edge6" class="edge">
<title>n1&%2345;&gt;n4</title>
<path fill="none" stroke="black" d="M49.72,-94.39C57.24,-87.98 65.85,-80.8 73.9,-74.5 81.9,-68.22 90.66,-61.68 99.01,-55.59"/>
<polygon fill="black" stroke="black" points="101.12,-58.38 107.17,-49.68 97.02,-52.71 101.12,-58.38"/>
<text text-anchor="middle" x="78.9" y="-78.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n2&%2345;&gt;n1 -->
<g id="edge5" class="edge">
<title>n2&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M108.19,-179.92C92.66,-166.71 73.33,-150.27 57.65,-136.92"/>
<polygon fill="black" stroke="black" points="59.71,-134.08 49.82,-130.26 55.17,-139.41 59.71,-134.08"/>
<text text-anchor="middle" x="78.9" y="-161.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n3&%2345;&gt;n1 -->
<g id="edge2" class="edge">
<title>n3&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M101.66,-100.2C95.87,-97.84 89.82,-95.8 83.9,-94.5 76.85,-92.95 69.42,-93.69 62.39,-95.56"/>
<polygon fill="black" stroke="black" points="60.78,-92.41 52.46,-98.96 63.05,-99.03 60.78,-92.41"/>
<text text-anchor="middle" x="78.9" y="-98.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n4&%2345;&gt;n1 -->
<g id="edge4" class="edge">
<title>n4&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M107.39,-16.32C96.25,-13.16 83.79,-12.26 73.9,-18.5 54.17,-30.93 42.91,-54.68 36.6,-75.19"/>
<polygon fill="black" stroke="black" points="33.19,-74.37 33.88,-84.94 39.94,-76.25 33.19,-74.37"/>
<text text-anchor="middle" x="78.9" y="-22.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
</g>
</svg>
'/><p>We define a simple SIRD model with reflexive transitions typed as <code>:strata</code> to indicate which states can be stratified. Here we add reflexive transitions to the susceptible, infected, and recovered populations but we leave out the dead population because they cannot do things such as get vaccinated or travel between regions.</p><pre><code class="language-julia hljs">sird_uwd = @relation (S,I,R,D) where (S::Pop, I::Pop, R::Pop, D::Pop) begin
  infect(S, I, I, I)
  disease(I, R)
  disease(I, D)
end

sird_model = oapply_typed(infectious_ontology, sird_uwd, [:infection, :recovery, :death])
sird_model = add_reflexives(sird_model, [[:strata], [:strata], [:strata], []], infectious_ontology)

to_graphviz(dom(sird_model))</code></pre><img src="89dc0385.svg" alt="Example block output"/><h2 id="Define-a-model-of-multiple-vaccine-types"><a class="docs-heading-anchor" href="#Define-a-model-of-multiple-vaccine-types">Define a model of multiple vaccine types</a><a id="Define-a-model-of-multiple-vaccine-types-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-model-of-multiple-vaccine-types" title="Permalink"></a></h2><p>We also define a model of vaccination with multiple vaccine types. In this model, vaccination transitions are typed as <code>:strata</code>. Note that the <code>:infect</code> transitions must be included to enable cross-infection between different vax types.</p><pre><code class="language-julia hljs">function vax_model(n)
  uwd = RelationDiagram(repeat([:Pop], n+1))

  variable = :Unvaxxed
  junction = add_junction!(uwd, :Pop, variable=variable)
  port = ports(uwd, outer=true)[1]
  set_junction!(uwd, port, junction, outer=true)
  junctions = Dict(variable =&gt; junction)
  for i in 1:n
    variable = Symbol(&quot;VaxType$(i)&quot;)
    junction = add_junction!(uwd, :Pop, variable=variable)
    port = ports(uwd, outer=true)[i+1]
    set_junction!(uwd, port, junction, outer=true)
    junctions[variable] = junction
  end

  strains = filter((x) -&gt; x != Symbol(&quot;Unvaxxed&quot;), keys(junctions))
  for s in strains
    pair = (:Unvaxxed, s)
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=:strata)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end
  tnames = [Symbol(&quot;vax_$(b)&quot;) for b in strains]

  pairs = collect(Iterators.product(keys(junctions), keys(junctions)))
  for pair in pairs
    ins_outs = (pair[1], pair[2], pair[1], pair[2])
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in ins_outs], name=:infect)
    for (rgn, port) in zip(ins_outs, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
    push!(tnames,Symbol(&quot;inf_$(pair[1])_$(pair[2])&quot;))
  end
  act = oapply_typed(infectious_ontology, uwd, tnames)
  add_reflexives(act, repeat([[:disease]], n+1), infectious_ontology)
end

to_graphviz(dom(vax_model(2)))</code></pre><img src="c21c5cc4.svg" alt="Example block output"/><h2 id="Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types"><a class="docs-heading-anchor" href="#Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types">Stratify the SIRD model with vaccinations for two vaccine types</a><a id="Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types-1"></a><a class="docs-heading-anchor-permalink" href="#Stratify-the-SIRD-model-with-vaccinations-for-two-vaccine-types" title="Permalink"></a></h2><p>We can now stratify the two typed models to get a model of SIRD with vaccination by multiple possible vaccine types.</p><pre><code class="language-julia hljs">typed_product(sird_model, vax_model(2)) |&gt; dom |&gt; to_graphviz</code></pre><img src="9e807279.svg" alt="Example block output"/><h2 id="Define-a-model-of-multiple-disease-strains"><a class="docs-heading-anchor" href="#Define-a-model-of-multiple-disease-strains">Define a model of multiple disease strains</a><a id="Define-a-model-of-multiple-disease-strains-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-model-of-multiple-disease-strains" title="Permalink"></a></h2><p>Here we define a model of multiple strains of disease infection. In this model, uninfected individuals can become infected by indivuals carrying one of the strains. This model can be typed  the <code>infectious_ontology</code>. We add reflexives of <code>:disease</code> and <code>:strata</code> for the strain states but only <code>:strata</code> for the uninfected state.</p><pre><code class="language-julia hljs">function strain_model′(n)
  uwd = RelationDiagram(repeat([:Pop], n+1))
  variable = :Uninfected
  junction = add_junction!(uwd, :Pop, variable=variable)
  port = ports(uwd, outer=true)[1]
  set_junction!(uwd, port, junction, outer=true)
  junctions = Dict(variable =&gt; junction)
  for i in 1:n
    variable = Symbol(&quot;Strain$(i)&quot;)
    junction = add_junction!(uwd, :Pop, variable=variable)
    port = ports(uwd, outer=true)[i+1]
    set_junction!(uwd, port, junction, outer=true)
    junctions[variable] = junction
  end
  strains = filter((x) -&gt; x != Symbol(&quot;Uninfected&quot;), keys(junctions))
  for s in strains
    pair = (:Uninfected, s, s, s)
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=:infect)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end
  act = oapply_typed(infectious_ontology, uwd, [Symbol(&quot;inf_$(b)&quot;) for b in strains])
  add_reflexives(act, vcat([[:strata]],repeat([[:disease,:strata]], n)), infectious_ontology)
end

to_graphviz(dom(strain_model′(2)))</code></pre><img src="3bf51460.svg" alt="Example block output"/><h2 id="Stratify-the-SIRD-model-for-two-strains"><a class="docs-heading-anchor" href="#Stratify-the-SIRD-model-for-two-strains">Stratify the SIRD model for two strains</a><a id="Stratify-the-SIRD-model-for-two-strains-1"></a><a class="docs-heading-anchor-permalink" href="#Stratify-the-SIRD-model-for-two-strains" title="Permalink"></a></h2><p>Unfortunately, stratification of these models does not produce the desired result. There are quite a few extraneous states and transitions. The primary issue is the asymmetry in the role of the uninfected population. We can address this by changing the type system.</p><pre><code class="language-julia hljs">typed_product(sird_model, strain_model′(2)) |&gt; dom |&gt; to_graphviz</code></pre><img src="8cedadb4.svg" alt="Example block output"/><h2 id="Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models"><a class="docs-heading-anchor" href="#Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models">Define a new type system and corresponding disease and multi-strain models</a><a id="Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-new-type-system-and-corresponding-disease-and-multi-strain-models" title="Permalink"></a></h2><p>The new type system has separate states for uninfected and infected to account for the asymmetry in their role in infection and for the corresponding asymmetry in the intended stratification. Accordingly, the <code>:Inf</code> state has <code>:disease</code> and <code>:strataI</code> transitions. The <code>:Uninf</code> state only has an additional &quot;strata&quot; transition, <code>:strataU</code>, but note this transition is distinct from that for the <code>:Inf</code> state.</p><pre><code class="language-julia hljs">const strain_ontology = LabelledPetriNet(
  [:Uninf, :Inf],
  :infect =&gt; ((:Uninf, :Inf) =&gt; (:Inf, :Inf)),
  :disease =&gt; (:Inf =&gt; :Inf),
  :strataI =&gt; (:Inf =&gt; :Inf),
  :strataU =&gt; (:Uninf =&gt; :Uninf)
)

to_graphviz(strain_ontology)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="407pt" height="211pt"
 viewBox="0.00 0.00 406.59 210.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 206.5)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-206.5 402.59,-206.5 402.59,4 -4,4"/>
<!-- n1 -->
<g id="node1" class="node">
<title>n1</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="36.4" cy="-73.5" rx="36.29" ry="36.29"/>
<text text-anchor="middle" x="36.4" y="-69.8" font-family="Times,serif" font-size="14.00">Uninf</text>
</g>
<!-- n3 -->
<g id="node3" class="node">
<title>n3</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="182.79,-146 125.79,-146 125.79,-89 182.79,-89 182.79,-146"/>
<text text-anchor="middle" x="154.29" y="-113.8" font-family="Times,serif" font-size="14.00">infect</text>
</g>
<!-- n1&%2345;&gt;n3 -->
<g id="edge6" class="edge">
<title>n1&%2345;&gt;n3</title>
<path fill="none" stroke="black" d="M70.61,-86.11C84.74,-91.47 101.28,-97.75 115.85,-103.28"/>
<polygon fill="black" stroke="black" points="114.97,-106.69 125.56,-106.97 117.45,-100.15 114.97,-106.69"/>
<text text-anchor="middle" x="95.79" y="-100.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n6 -->
<g id="node6" class="node">
<title>n6</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="189.79,-71 118.79,-71 118.79,0 189.79,0 189.79,-71"/>
<text text-anchor="middle" x="154.29" y="-31.8" font-family="Times,serif" font-size="14.00">strataU</text>
</g>
<!-- n1&%2345;&gt;n6 -->
<g id="edge7" class="edge">
<title>n1&%2345;&gt;n6</title>
<path fill="none" stroke="black" d="M71.23,-62.41C82.93,-58.57 96.24,-54.21 108.67,-50.13"/>
<polygon fill="black" stroke="black" points="110,-53.38 118.41,-46.94 107.82,-46.73 110,-53.38"/>
<text text-anchor="middle" x="95.79" y="-60.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n2 -->
<g id="node2" class="node">
<title>n2</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="259.19" cy="-117.5" rx="23.3" ry="23.3"/>
<text text-anchor="middle" x="259.19" y="-113.8" font-family="Times,serif" font-size="14.00">Inf</text>
</g>
<!-- n2&%2345;&gt;n3 -->
<g id="edge9" class="edge">
<title>n2&%2345;&gt;n3</title>
<path fill="none" stroke="black" d="M238.68,-106.21C232.24,-103.07 224.9,-100.09 217.79,-98.5 209.61,-96.67 200.94,-97.48 192.75,-99.56"/>
<polygon fill="black" stroke="black" points="191.53,-96.28 183.06,-102.64 193.65,-102.95 191.53,-96.28"/>
<text text-anchor="middle" x="212.79" y="-102.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n4 -->
<g id="node4" class="node">
<title>n4</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="398.59,-202.5 328.59,-202.5 328.59,-132.5 398.59,-132.5 398.59,-202.5"/>
<text text-anchor="middle" x="363.59" y="-163.8" font-family="Times,serif" font-size="14.00">disease</text>
</g>
<!-- n2&%2345;&gt;n4 -->
<g id="edge1" class="edge">
<title>n2&%2345;&gt;n4</title>
<path fill="none" stroke="black" d="M275.77,-134.11C282.78,-140.71 291.51,-147.83 300.59,-152.5 306.21,-155.4 312.41,-157.75 318.65,-159.65"/>
<polygon fill="black" stroke="black" points="317.84,-163.06 328.4,-162.29 319.66,-156.3 317.84,-163.06"/>
<text text-anchor="middle" x="305.59" y="-160.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n5 -->
<g id="node5" class="node">
<title>n5</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="396.09,-107 331.09,-107 331.09,-42 396.09,-42 396.09,-107"/>
<text text-anchor="middle" x="363.59" y="-70.8" font-family="Times,serif" font-size="14.00">strataI</text>
</g>
<!-- n2&%2345;&gt;n5 -->
<g id="edge3" class="edge">
<title>n2&%2345;&gt;n5</title>
<path fill="none" stroke="black" d="M280.68,-108.2C287.04,-105.36 294.09,-102.26 300.59,-99.5 307.35,-96.63 314.55,-93.66 321.57,-90.8"/>
<polygon fill="black" stroke="black" points="323,-94 330.96,-87 320.38,-87.51 323,-94"/>
<text text-anchor="middle" x="305.59" y="-103.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n3&%2345;&gt;n2 -->
<g id="edge2" class="edge">
<title>n3&%2345;&gt;n2</title>
<path fill="none" stroke="black" d="M182.87,-117.5C196.06,-117.5 211.93,-117.5 225.7,-117.5"/>
<polygon fill="black" stroke="black" points="225.74,-121 235.74,-117.5 225.74,-114 225.74,-121"/>
<text text-anchor="middle" x="212.79" y="-121.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n4&%2345;&gt;n2 -->
<g id="edge4" class="edge">
<title>n4&%2345;&gt;n2</title>
<path fill="none" stroke="black" d="M328.39,-143.28C322.6,-139.73 316.53,-136.32 310.59,-133.5 304.71,-130.71 298.23,-128.24 291.92,-126.12"/>
<polygon fill="black" stroke="black" points="292.86,-122.75 282.27,-123.1 290.76,-129.43 292.86,-122.75"/>
<text text-anchor="middle" x="305.59" y="-137.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n5&%2345;&gt;n2 -->
<g id="edge5" class="edge">
<title>n5&%2345;&gt;n2</title>
<path fill="none" stroke="black" d="M330.99,-71.01C320.92,-71.07 309.96,-72.4 300.59,-76.5 292.99,-79.82 286.08,-85.3 280.2,-91.18"/>
<polygon fill="black" stroke="black" points="277.48,-88.97 273.34,-98.72 282.66,-93.69 277.48,-88.97"/>
<text text-anchor="middle" x="305.59" y="-80.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n6&%2345;&gt;n1 -->
<g id="edge8" class="edge">
<title>n6&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M118.63,-30.93C109.4,-30.79 99.56,-31.64 90.79,-34.5 84.34,-36.61 78.02,-39.82 72.12,-43.52"/>
<polygon fill="black" stroke="black" points="70.07,-40.67 63.79,-49.21 74.02,-46.45 70.07,-40.67"/>
<text text-anchor="middle" x="95.79" y="-38.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
</g>
</svg>
'/><p>We now reform the SIRD model using the new type system.</p><pre><code class="language-julia hljs">sird_for_strains_uwd = @relation (S,I,R,D) where (S::Uninf, I::Inf, R::Inf, D::Inf) begin
  infect(S, I, I, I)
  disease(I, R)
  disease(I, D)
end
sird_for_strains_model = oapply_typed(strain_ontology, sird_for_strains_uwd, [:infection, :recovery, :death])
sird_for_strains_model = add_reflexives(sird_for_strains_model, [[:strataU], [:strataI], [:strataI], []], strain_ontology)

to_graphviz(dom(sird_for_strains_model))</code></pre><img src="f3c70ce2.svg" alt="Example block output"/><p>And similarly reform the multi-strain model.</p><pre><code class="language-julia hljs">function strain_model(n)
  uwd = RelationDiagram(vcat([:Uninf],repeat([:Inf], n)))
  variable = :Uninfected
  junction = add_junction!(uwd, :Uninf, variable=variable)
  port = ports(uwd, outer=true)[1]
  set_junction!(uwd, port, junction, outer=true)
  junctions = Dict(variable =&gt; junction)
  for i in 1:n
    variable = Symbol(&quot;Strain$(i)&quot;)
    junction = add_junction!(uwd, :Inf, variable=variable)
    port = ports(uwd, outer=true)[i+1]
    set_junction!(uwd, port, junction, outer=true)
    junctions[variable] = junction
  end
  strains = filter((x) -&gt; x != Symbol(&quot;Uninfected&quot;), keys(junctions))
  for s in strains
    pair = (:Uninfected, s, s, s)
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=:infect)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end
  act = oapply_typed(strain_ontology, uwd, [Symbol(&quot;inf_$(b)&quot;) for b in strains])
  add_reflexives(act, vcat([[:strataU]],repeat([[:disease,:strataI]], n)), strain_ontology)
end

to_graphviz(dom(strain_model(2)))</code></pre><img src="5dec749e.svg" alt="Example block output"/><p>When we now stratify we get the desired model.</p><pre><code class="language-julia hljs">sird_strain = typed_product(sird_for_strains_model, strain_model(2))

to_graphviz(dom(sird_strain))</code></pre><img src="175463f1.svg" alt="Example block output"/><h2 id="Post-composition:-Typing-the-type-system"><a class="docs-heading-anchor" href="#Post-composition:-Typing-the-type-system">Post-composition: Typing the type system</a><a id="Post-composition:-Typing-the-type-system-1"></a><a class="docs-heading-anchor-permalink" href="#Post-composition:-Typing-the-type-system" title="Permalink"></a></h2><p>In some instances, we may want to relate models typed to different type systems. For example, we usually type our <code>simple_trip</code> model of geographic regions to the <code>infectious_ontology</code> such that we can stratify a disease model by geographic regions, but the multi-strain disease model above is typed by the new <code>strain_ontology</code>.</p><p>Crucially, we can accomplish this IF there is an appropriate morphism (map) between the type systems because post-composition by a morphism of type systems is functorial. In this case, there is a morphism from <code>strain_ontology</code> to <code>infectious_ontology</code>, so we can form the morphism</p><h3 id="Morphism-from-strain_ontology-to-infectious_ontology"><a class="docs-heading-anchor" href="#Morphism-from-strain_ontology-to-infectious_ontology">Morphism from <code>strain_ontology</code> to <code>infectious_ontology</code></a><a id="Morphism-from-strain_ontology-to-infectious_ontology-1"></a><a class="docs-heading-anchor-permalink" href="#Morphism-from-strain_ontology-to-infectious_ontology" title="Permalink"></a></h3><pre><code class="language-julia hljs">strain_ont_uwd = @relation (Uninf,Inf) where (Uninf::Pop, Inf::Pop) begin
  infect(Uninf, Inf, Inf, Inf)
  disease(Inf, Inf)
  strata(Inf, Inf)
  strata(Uninf, Uninf)
end
strain_ont_act = oapply_typed(infectious_ontology,strain_ont_uwd,[:infect,:disease,:strataI,:strataU])

to_graphviz(strain_ont_act)</code></pre><img src="b92ffe5c.svg" alt="Example block output"/><h3 id="Define-simple-trip-geographic-model-of-N-regions"><a class="docs-heading-anchor" href="#Define-simple-trip-geographic-model-of-N-regions">Define simple-trip geographic model of <span>$N$</span> regions</a><a id="Define-simple-trip-geographic-model-of-N-regions-1"></a><a class="docs-heading-anchor-permalink" href="#Define-simple-trip-geographic-model-of-N-regions" title="Permalink"></a></h3><p>To demonstrate stratification utilizing post-composition to re-type the models, we use the simple-trip geographic model. This model is comprises a travel model and a living model.</p><p><strong>Travel model between <span>$N$</span> regions</strong>\n In this model, there are <span>$N$</span> regions which people can travel between. People within the same region are able to infect other people in the same region.</p><pre><code class="language-julia hljs">function travel_model(n)
  uwd = RelationDiagram(repeat([:Pop], n))
  junctions = Dict(begin
    variable = Symbol(&quot;Region$(i)&quot;)
    junction = add_junction!(uwd, :Pop, variable=variable)
    set_junction!(uwd, port, junction, outer=true)
    variable =&gt; junction
  end for (i, port) in enumerate(ports(uwd, outer=true)))

  pairs = filter(x -&gt; first(x) != last(x), collect(Iterators.product(keys(junctions), keys(junctions))))
  for pair in pairs
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=:strata)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end

  act = oapply_typed(infectious_ontology, uwd, [Symbol(&quot;$(a)_$(b)&quot;) for (a, b) in pairs])
  add_reflexives(act, repeat([[:infect, :disease]], n), infectious_ontology)
end

to_graphviz(dom(travel_model(2)))</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="621pt" height="363pt"
 viewBox="0.00 0.00 620.98 363.05" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 359.05)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-359.05 616.98,-359.05 616.98,4 -4,4"/>
<!-- n1 -->
<g id="node1" class="node">
<title>n1</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="48.75" cy="-106.05" rx="48.99" ry="48.99"/>
<text text-anchor="middle" x="48.75" y="-102.35" font-family="Times,serif" font-size="14.00">Region2</text>
</g>
<!-- n3 -->
<g id="node3" class="node">
<title>n3</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="283.49,-333.05 143.49,-333.05 143.49,-193.05 283.49,-193.05 283.49,-333.05"/>
<text text-anchor="middle" x="213.49" y="-259.35" font-family="Times,serif" font-size="14.00">Region2_Region1</text>
</g>
<!-- n1&%2345;&gt;n3 -->
<g id="edge1" class="edge">
<title>n1&%2345;&gt;n3</title>
<path fill="none" stroke="black" d="M84.66,-139.73C99.7,-154.24 117.92,-171.81 135.83,-189.09"/>
<polygon fill="black" stroke="black" points="133.85,-192.05 143.48,-196.47 138.71,-187.01 133.85,-192.05"/>
<text text-anchor="middle" x="120.49" y="-178.85" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n5 -->
<g id="node5" class="node">
<title>n5</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="241.99,-174.55 184.99,-174.55 184.99,-117.55 241.99,-117.55 241.99,-174.55"/>
<text text-anchor="middle" x="213.49" y="-142.35" font-family="Times,serif" font-size="14.00">infect</text>
</g>
<!-- n1&%2345;&gt;n5 -->
<g id="edge6" class="edge">
<title>n1&%2345;&gt;n5</title>
<path fill="none" stroke="black" d="M90.69,-131.33C98.66,-135.23 107.14,-138.74 115.49,-141.05 134.51,-146.32 156.41,-147.82 174.59,-147.89"/>
<polygon fill="black" stroke="black" points="174.84,-151.39 184.81,-147.78 174.77,-144.39 174.84,-151.39"/>
<text text-anchor="middle" x="120.49" y="-145.85" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n6 -->
<g id="node6" class="node">
<title>n6</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="248.49,-99.05 178.49,-99.05 178.49,-29.05 248.49,-29.05 248.49,-99.05"/>
<text text-anchor="middle" x="213.49" y="-60.35" font-family="Times,serif" font-size="14.00">disease</text>
</g>
<!-- n1&%2345;&gt;n6 -->
<g id="edge9" class="edge">
<title>n1&%2345;&gt;n6</title>
<path fill="none" stroke="black" d="M96.38,-94.01C119.03,-88.17 146.09,-81.19 168.39,-75.43"/>
<polygon fill="black" stroke="black" points="169.46,-78.77 178.26,-72.88 167.71,-71.99 169.46,-78.77"/>
<text text-anchor="middle" x="120.49" y="-91.85" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n2 -->
<g id="node2" class="node">
<title>n2</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="378.24" cy="-251.05" rx="48.99" ry="48.99"/>
<text text-anchor="middle" x="378.24" y="-247.35" font-family="Times,serif" font-size="14.00">Region1</text>
</g>
<!-- n4 -->
<g id="node4" class="node">
<title>n4</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="612.98,-140.05 472.98,-140.05 472.98,-0.05 612.98,-0.05 612.98,-140.05"/>
<text text-anchor="middle" x="542.98" y="-66.35" font-family="Times,serif" font-size="14.00">Region1_Region2</text>
</g>
<!-- n2&%2345;&gt;n4 -->
<g id="edge10" class="edge">
<title>n2&%2345;&gt;n4</title>
<path fill="none" stroke="black" d="M411.39,-215.29C428.78,-195.95 450.97,-171.28 472.1,-147.77"/>
<polygon fill="black" stroke="black" points="474.83,-149.97 478.92,-140.19 469.63,-145.29 474.83,-149.97"/>
<text text-anchor="middle" x="449.98" y="-179.85" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n7 -->
<g id="node7" class="node">
<title>n7</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="571.48,-250.55 514.48,-250.55 514.48,-193.55 571.48,-193.55 571.48,-250.55"/>
<text text-anchor="middle" x="542.98" y="-218.35" font-family="Times,serif" font-size="14.00">infect</text>
</g>
<!-- n2&%2345;&gt;n7 -->
<g id="edge5" class="edge">
<title>n2&%2345;&gt;n7</title>
<path fill="none" stroke="black" d="M426.31,-242.66C451.06,-238.25 480.99,-232.92 504.2,-228.78"/>
<polygon fill="black" stroke="black" points="505.12,-232.17 514.35,-226.97 503.89,-225.28 505.12,-232.17"/>
<text text-anchor="middle" x="449.98" y="-242.85" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n8 -->
<g id="node8" class="node">
<title>n8</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="577.98,-355.05 507.98,-355.05 507.98,-285.05 577.98,-285.05 577.98,-355.05"/>
<text text-anchor="middle" x="542.98" y="-316.35" font-family="Times,serif" font-size="14.00">disease</text>
</g>
<!-- n2&%2345;&gt;n8 -->
<g id="edge7" class="edge">
<title>n2&%2345;&gt;n8</title>
<path fill="none" stroke="black" d="M423.28,-269.72C446.69,-279.65 475.37,-291.81 498.68,-301.69"/>
<polygon fill="black" stroke="black" points="497.4,-304.95 507.97,-305.63 500.13,-298.5 497.4,-304.95"/>
<text text-anchor="middle" x="449.98" y="-284.85" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n3&%2345;&gt;n2 -->
<g id="edge2" class="edge">
<title>n3&%2345;&gt;n2</title>
<path fill="none" stroke="black" d="M283.51,-257.96C295.44,-257.08 307.73,-256.17 319.32,-255.32"/>
<polygon fill="black" stroke="black" points="319.59,-258.81 329.31,-254.58 319.08,-251.83 319.59,-258.81"/>
<text text-anchor="middle" x="306.49" y="-259.85" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n4&%2345;&gt;n1 -->
<g id="edge3" class="edge">
<title>n4&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M472.88,-41.71C391.38,-12.69 253.14,22.63 143.49,-20.05 121.89,-28.45 102.25,-44.42 86.59,-60.33"/>
<polygon fill="black" stroke="black" points="84.03,-57.95 79.68,-67.61 89.1,-62.77 84.03,-57.95"/>
<text text-anchor="middle" x="306.49" y="-7.85" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n5&%2345;&gt;n1 -->
<g id="edge8" class="edge">
<title>n5&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M184.79,-137.94C167.75,-133.07 145.44,-126.9 125.49,-122.05 119.41,-120.57 113.03,-119.1 106.66,-117.68"/>
<polygon fill="black" stroke="black" points="107.23,-114.22 96.72,-115.5 105.74,-121.06 107.23,-114.22"/>
<text text-anchor="middle" x="120.49" y="-125.85" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n6&%2345;&gt;n1 -->
<g id="edge11" class="edge">
<title>n6&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M178.18,-61.5C159.32,-61.08 135.72,-62.17 115.49,-68.05 109.81,-69.7 104.11,-71.93 98.56,-74.5"/>
<polygon fill="black" stroke="black" points="96.77,-71.49 89.4,-79.09 99.91,-77.74 96.77,-71.49"/>
<text text-anchor="middle" x="120.49" y="-71.85" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n7&%2345;&gt;n2 -->
<g id="edge4" class="edge">
<title>n7&%2345;&gt;n2</title>
<path fill="none" stroke="black" d="M514.35,-212.35C494.68,-206.89 467.82,-202.38 444.98,-209.05 438.75,-210.87 432.55,-213.48 426.59,-216.52"/>
<polygon fill="black" stroke="black" points="424.49,-213.68 417.44,-221.6 427.89,-219.8 424.49,-213.68"/>
<text text-anchor="middle" x="449.98" y="-212.85" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n8&%2345;&gt;n2 -->
<g id="edge12" class="edge">
<title>n8&%2345;&gt;n2</title>
<path fill="none" stroke="black" d="M507.64,-316.68C488.55,-313.9 464.75,-308.92 444.98,-300.05 437.86,-296.85 430.77,-292.78 424.03,-288.34"/>
<polygon fill="black" stroke="black" points="425.91,-285.39 415.7,-282.58 421.93,-291.15 425.91,-285.39"/>
<text text-anchor="middle" x="449.98" y="-307.85" font-family="Times,serif" font-size="14.00">1</text>
</g>
</g>
</svg>
'/><p>This model could itself be stratified with the SIRD model, but we want to model persons travelling between locations while maintaining the status of where they live.</p><p><strong>Living model of <span>$N$</span> regions</strong>\n In this model, people have the property of &quot;Living&quot; somewhere.</p><pre><code class="language-julia hljs">function living_model(n)
  typed_living = pairwise_id_typed_petri(infectious_ontology, :Pop, :infect, [Symbol(&quot;Living$(i)&quot;) for i in 1:n])
  add_reflexives(typed_living, repeat([[:disease, :strata]], n), infectious_ontology)
end

to_graphviz(dom(living_model(2)))</code></pre><img src="1e6f81c0.svg" alt="Example block output"/><p><strong>Simple trip model of <span>$N$</span> regions</strong>\n We can stratify the living model with the travel model to get a model of someone taking a simple trip.</p><pre><code class="language-julia hljs">simple_trip_model = typed_product(travel_model(2), living_model(2))

to_graphviz(dom(simple_trip_model))</code></pre><img src="6a954edc.svg" alt="Example block output"/><h3 id="Stratify-SIRD-multi-strain-and-simple-trip-models"><a class="docs-heading-anchor" href="#Stratify-SIRD-multi-strain-and-simple-trip-models">Stratify SIRD-multi-strain and simple-trip models</a><a id="Stratify-SIRD-multi-strain-and-simple-trip-models-1"></a><a class="docs-heading-anchor-permalink" href="#Stratify-SIRD-multi-strain-and-simple-trip-models" title="Permalink"></a></h3><p>Now, to stratify our multi-strain SIRD model with the simple-trip, we first retype the multi-strain model to the <code>infectious_ontology</code> by composing with the morphism we defined.</p><pre><code class="language-julia hljs">sird_strain_retyped = compose(sird_strain,strain_ont_act)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ACSetTransformation((T = compose(compose(compose(FinFunction([1, 7, 16, 20, 21, 29, 30, 32, 33, 41, 42], 11, 42), FinFunction(#57, FinSet(42), FinSet(6))), FinFunction([1, 2, 2, 4, 3, 3], 6, 4)), FinFunction([1, 2, 3, 3], 4, 3)), S = compose(compose(compose(FinFunction([1, 6, 7, 8, 10, 11, 12], 7, 12), FinFunction(#57, FinSet(12), FinSet(4))), FinFunction([1, 2, 2, 2], 4, 2)), FinFunction([1, 1], 2, 1)), I = compose(compose(compose(FinFunction([1, 9, 15, 23, 33, 38, 39, 48, 49, 52, 53, 62, 63], 13, 63), FinFunction(#57, FinSet(63), FinSet(7))), FinFunction([1, 2, 3, 3, 5, 4, 4], 7, 5)), FinFunction([1, 2, 3, 4, 4], 5, 4)), O = compose(compose(compose(FinFunction([1, 9, 15, 23, 33, 38, 39, 48, 49, 52, 53, 62, 63], 13, 63), FinFunction(#57, FinSet(63), FinSet(7))), FinFunction([1, 2, 3, 3, 5, 4, 4], 7, 5)), FinFunction([1, 2, 3, 4, 4], 5, 4)), Name = Catlab.CategoricalAlgebra.FinSets.LooseVarFunction{Tuple{Symbol, Symbol}, Symbol}(FinDomFunction(Union{ACSets.ColumnImplementations.AttrVar, Symbol}[], FinSet(0), TypeSet(Union{ACSets.ColumnImplementations.AttrVar, Symbol})), compose(compose(SetFunction(#23, TypeSet(Tuple{Symbol, Symbol}), TypeSet(Symbol)), SetFunction(#17, TypeSet(Symbol), TypeSet(Symbol))), SetFunction(#10, TypeSet(Symbol), TypeSet(Symbol))), FinSet(0))), AlgebraicPetri.LabelledPetriNetUntyped{Tuple{Symbol, Symbol}} {T:11, S:7, I:13, O:13, Name:0}, LabelledPetriNet {T:3, S:1, I:4, O:4, Name:0})</code></pre><p>We can now stratify.</p><pre><code class="language-julia hljs">sird_strain_trip = typed_product(sird_strain_retyped,simple_trip_model)

to_graphviz(dom(sird_strain_trip))</code></pre><img src="0255d039.svg" alt="Example block output"/><h2 id="Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types"><a class="docs-heading-anchor" href="#Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types">Define a multi-strain SIRD model with vaccination by multiple vaccine types</a><a id="Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types-1"></a><a class="docs-heading-anchor-permalink" href="#Define-a-multi-strain-SIRD-model-with-vaccination-by-multiple-vaccine-types" title="Permalink"></a></h2><p>We can similarly stratify the multi-strain SIRD model with the multi-vax model.</p><pre><code class="language-julia hljs">sird_strain_vax = typed_product(sird_strain_retyped,vax_model(2))

to_graphviz(dom(sird_strain_vax))</code></pre><img src="5ac874d8.svg" alt="Example block output"/><h2 id="Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model"><a class="docs-heading-anchor" href="#Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model">Re-stratify the multi-strain multi-vax SIRD model with the simple trip model</a><a id="Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model-1"></a><a class="docs-heading-anchor-permalink" href="#Re-stratify-the-multi-strain-multi-vax-SIRD-model-with-the-simple-trip-model" title="Permalink"></a></h2><p>If we would like to re-stratify our SIRD-strain-vax model with the simple trip model, we again face a difficulty. Both the &quot;vaccination&quot; transitions of the first model and the &quot;travel&quot; transitions of the second are currently typed to the <code>:strata</code> transition of the <code>infectious_ontology</code> type system. To appropriately stratify, we need an additional &quot;strata&quot; transition to distinguish between the two types of transitions. We can again use post-compostion to overcome the difficulty.</p><h3 id="Define-an-augmented-version-of-the-infectious_ontology-type-system-with-an-additional-&quot;strata&quot;-transition"><a class="docs-heading-anchor" href="#Define-an-augmented-version-of-the-infectious_ontology-type-system-with-an-additional-&quot;strata&quot;-transition">Define an augmented version of the <code>infectious_ontology</code> type system with an additional &quot;strata&quot; transition</a><a id="Define-an-augmented-version-of-the-infectious_ontology-type-system-with-an-additional-&quot;strata&quot;-transition-1"></a><a class="docs-heading-anchor-permalink" href="#Define-an-augmented-version-of-the-infectious_ontology-type-system-with-an-additional-&quot;strata&quot;-transition" title="Permalink"></a></h3><pre><code class="language-julia hljs">const aug_inf_ontology = LabelledPetriNet(
  [:nPop],
  :ninfect =&gt; ((:nPop, :nPop) =&gt; (:nPop, :nPop)),
  :ndisease =&gt; (:nPop =&gt; :nPop),
  :nstrata =&gt; (:nPop =&gt; :nPop),
  :nstrata2 =&gt; (:nPop =&gt; :nPop)
)

to_graphviz(aug_inf_ontology)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="201pt" height="354pt"
 viewBox="0.00 0.00 200.59 353.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 349.5)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-349.5 196.59,-349.5 196.59,4 -4,4"/>
<!-- n1 -->
<g id="node1" class="node">
<title>n1</title>
<ellipse fill="%236c9ac3" stroke="%236c9ac3" cx="33.8" cy="-178.5" rx="33.6" ry="33.6"/>
<text text-anchor="middle" x="33.8" y="-174.8" font-family="Times,serif" font-size="14.00">nPop</text>
</g>
<!-- n2 -->
<g id="node2" class="node">
<title>n2</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="186.09,-345.5 120.09,-345.5 120.09,-279.5 186.09,-279.5 186.09,-345.5"/>
<text text-anchor="middle" x="153.09" y="-308.8" font-family="Times,serif" font-size="14.00">ninfect</text>
</g>
<!-- n1&%2345;&gt;n2 -->
<g id="edge1" class="edge">
<title>n1&%2345;&gt;n2</title>
<path fill="none" stroke="black" d="M42.33,-211.36C49.57,-235.97 62.85,-268.84 85.59,-289.5 92.57,-295.83 101.37,-300.44 110.27,-303.78"/>
<polygon fill="black" stroke="black" points="109.3,-307.14 119.89,-306.93 111.48,-300.49 109.3,-307.14"/>
<text text-anchor="middle" x="90.59" y="-299.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n3 -->
<g id="node3" class="node">
<title>n3</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="192.59,-261 113.59,-261 113.59,-182 192.59,-182 192.59,-261"/>
<text text-anchor="middle" x="153.09" y="-217.8" font-family="Times,serif" font-size="14.00">ndisease</text>
</g>
<!-- n1&%2345;&gt;n3 -->
<g id="edge4" class="edge">
<title>n1&%2345;&gt;n3</title>
<path fill="none" stroke="black" d="M60.32,-199.63C68.02,-204.99 76.78,-210.17 85.59,-213.5 91.17,-215.61 97.18,-217.19 103.22,-218.38"/>
<polygon fill="black" stroke="black" points="102.92,-221.88 113.36,-220.02 104.04,-214.97 102.92,-221.88"/>
<text text-anchor="middle" x="90.59" y="-219.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n4 -->
<g id="node4" class="node">
<title>n4</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="187.09,-163.5 119.09,-163.5 119.09,-95.5 187.09,-95.5 187.09,-163.5"/>
<text text-anchor="middle" x="153.09" y="-125.8" font-family="Times,serif" font-size="14.00">nstrata</text>
</g>
<!-- n1&%2345;&gt;n4 -->
<g id="edge7" class="edge">
<title>n1&%2345;&gt;n4</title>
<path fill="none" stroke="black" d="M65.31,-165.75C78.78,-160.12 94.86,-153.41 109.49,-147.3"/>
<polygon fill="black" stroke="black" points="110.97,-150.47 118.85,-143.39 108.27,-144.01 110.97,-150.47"/>
<text text-anchor="middle" x="90.59" y="-160.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n5 -->
<g id="node5" class="node">
<title>n5</title>
<polygon fill="%23e28f41" stroke="%23e28f41" points="191.59,-77 114.59,-77 114.59,0 191.59,0 191.59,-77"/>
<text text-anchor="middle" x="153.09" y="-34.8" font-family="Times,serif" font-size="14.00">nstrata2</text>
</g>
<!-- n1&%2345;&gt;n5 -->
<g id="edge8" class="edge">
<title>n1&%2345;&gt;n5</title>
<path fill="none" stroke="black" d="M51.33,-149.54C60.58,-134.32 72.81,-115.72 85.59,-100.5 92.07,-92.8 99.44,-85.08 106.86,-77.85"/>
<polygon fill="black" stroke="black" points="109.45,-80.22 114.27,-70.78 104.62,-75.15 109.45,-80.22"/>
<text text-anchor="middle" x="90.59" y="-104.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n2&%2345;&gt;n1 -->
<g id="edge6" class="edge">
<title>n2&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M121.31,-279.12C118.69,-276.22 116.09,-273.31 113.59,-270.5 96.54,-251.25 77.8,-229.41 62.88,-211.83"/>
<polygon fill="black" stroke="black" points="65.44,-209.45 56.31,-204.08 60.1,-213.97 65.44,-209.45"/>
<text text-anchor="middle" x="90.59" y="-251.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- n3&%2345;&gt;n1 -->
<g id="edge2" class="edge">
<title>n3&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M113.33,-205.31C107.41,-202.96 101.36,-200.62 95.59,-198.5 89.22,-196.16 82.42,-193.79 75.76,-191.55"/>
<polygon fill="black" stroke="black" points="76.77,-188.2 66.18,-188.37 74.57,-194.84 76.77,-188.2"/>
<text text-anchor="middle" x="90.59" y="-202.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n4&%2345;&gt;n1 -->
<g id="edge5" class="edge">
<title>n4&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M118.92,-119.47C107.93,-117.84 95.89,-117.94 85.59,-122.5 75.59,-126.93 66.71,-134.42 59.29,-142.49"/>
<polygon fill="black" stroke="black" points="56.44,-140.45 52.64,-150.34 61.78,-144.98 56.44,-140.45"/>
<text text-anchor="middle" x="90.59" y="-126.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n5&%2345;&gt;n1 -->
<g id="edge3" class="edge">
<title>n5&%2345;&gt;n1</title>
<path fill="none" stroke="black" d="M114.58,-35.51C104.32,-36.44 93.79,-39.2 85.59,-45.5 58.07,-66.66 45.46,-104.63 39.68,-134.6"/>
<polygon fill="black" stroke="black" points="36.17,-134.37 37.91,-144.82 43.07,-135.57 36.17,-134.37"/>
<text text-anchor="middle" x="90.59" y="-49.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
</g>
</svg>
'/><h3 id="Define-morphisms-from-the-original-type-system-to-the-new-augmented-type-system"><a class="docs-heading-anchor" href="#Define-morphisms-from-the-original-type-system-to-the-new-augmented-type-system">Define morphisms from the original type system to the new augmented type system</a><a id="Define-morphisms-from-the-original-type-system-to-the-new-augmented-type-system-1"></a><a class="docs-heading-anchor-permalink" href="#Define-morphisms-from-the-original-type-system-to-the-new-augmented-type-system" title="Permalink"></a></h3><p>We form one morphism that maps the <code>:strata</code> transition to <code>:nstrata</code>. This morphism will serve to re-type the SIRD-strain-vax model.</p><pre><code class="language-julia hljs">function retype_inf_ont(strata_map)
  uwd = RelationDiagram([:nPop])
  variable = :Pop
  junction = add_junction!(uwd, :nPop, variable=variable)
  port = ports(uwd, outer=true)[1]
  set_junction!(uwd, port, junction, outer=true)
  junctions = Dict(variable =&gt; junction)

  boxes = [:ninfect, :ndisease, strata_map]
  for bname in boxes
    if bname == :ninfect
      pair = (:Pop, :Pop, :Pop, :Pop)
    else
      pair = (:Pop, :Pop)
    end
    box = add_box!(uwd, [junction_type(uwd, junctions[p]) for p in pair], name=bname)
    for (rgn, port) in zip(pair, ports(uwd, box))
      set_junction!(uwd, port, junctions[rgn])
    end
  end

  act = oapply_typed(aug_inf_ontology, uwd, [:infect, :disease, :strata])
end

inf_ont_act = retype_inf_ont(:nstrata)

to_graphviz(inf_ont_act)</code></pre><img src="ce51a5f7.svg" alt="Example block output"/><p>We form another morphism that maps the <code>:strata</code> transition to <code>:nstrata2</code>. This morphism will serve to re-type the simple trip model.</p><pre><code class="language-julia hljs">rgn_ont_act = retype_inf_ont(:nstrata2)

to_graphviz(rgn_ont_act)</code></pre><img src="d300f5d0.svg" alt="Example block output"/><h3 id="Add-reflexive-transitions"><a class="docs-heading-anchor" href="#Add-reflexive-transitions">Add reflexive transitions</a><a id="Add-reflexive-transitions-1"></a><a class="docs-heading-anchor-permalink" href="#Add-reflexive-transitions" title="Permalink"></a></h3><p>To finish preparing for stratification, we need to add the new reflexive transitions to the component models. To the SIRD-strain-vax model, we add an <code>:nstrata2</code> tranisiton to each state that does not represent a portion of the population that is deceased (because deceased individuals cannot travel).</p><pre><code class="language-julia hljs">sird_strain_vax_retyped = flatten_labels(compose(sird_strain_vax,inf_ont_act))
reflx = [[:nstrata2]]
for ii in 2:ns(dom(sird_strain_vax_retyped))
  if split(String(dom(sird_strain_vax_retyped)[ii,:sname]),&quot;_&quot;)[1] == &quot;D&quot;
    push!(reflx,[])
  else
    push!(reflx,[:nstrata2])
  end
end
aug_sird_strain_vax = add_reflexives(sird_strain_vax_retyped, reflx, aug_inf_ontology);</code></pre><p>To the simple trip model, we add an <code>:nstrata</code> tranisiton for each state.</p><pre><code class="language-julia hljs">simple_trip_retyped = flatten_labels(compose(simple_trip_model,rgn_ont_act))
aug_trip = add_reflexives(simple_trip_retyped, repeat([[:nstrata]],ns(dom(simple_trip_retyped))), aug_inf_ontology);</code></pre><h3 id="Stratify-the-SIRD-strain-vax-and-simple-trip-models"><a class="docs-heading-anchor" href="#Stratify-the-SIRD-strain-vax-and-simple-trip-models">Stratify the SIRD-strain-vax and simple trip models</a><a id="Stratify-the-SIRD-strain-vax-and-simple-trip-models-1"></a><a class="docs-heading-anchor-permalink" href="#Stratify-the-SIRD-strain-vax-and-simple-trip-models" title="Permalink"></a></h3><pre><code class="language-julia hljs">sird_strain_vax_trip = typed_product([aug_sird_strain_vax,aug_trip])

to_graphviz(dom(sird_strain_vax_trip))</code></pre><img src="66c2dd49.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../stratification/">« Stratification of COVID Models</a><a class="docs-footer-nextpage" href="../max_common_subobject/">Maximum Common Sub C-Set »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Sunday 29 October 2023 00:29">Sunday 29 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
